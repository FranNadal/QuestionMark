<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Seleccionar categoría</title>

    <!-- W3CSS + tema -->
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-purple.css">
    <!-- Iconos / fuente -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Nunito&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/QuestionMark/view/styles/headerStyles.css">
    <link rel="icon" type="image/x-icon" href="/QuestionMark/view/img_page/icono_pagina.ico">
    <style>
        body { font-family: 'Nunito', sans-serif; }
        #ruleta        { width: 280px; transition: transform 3s ease-out; cursor:pointer; }
        #categoriaBox  { font-weight:bold; font-size:1.7rem; margin-top:12px; }
        .leyenda       { display:grid; grid-template-columns:repeat(auto-fit,minmax(110px,1fr)); gap:6px; max-width:450px; margin:24px auto;}
        .leyenda span  { display:flex; align-items:center; gap:6px; }
        .cuadro-color  { flex:0 0 16px; height:16px; border-radius:4px; }
    </style>
</head>
<body>

{{> header}}

<div class="w3-container w3-center w3-padding-large">
    <h2>¡Girá la ruleta para elegir categoría!</h2>

    <!-- Imagen de la ruleta -->
    <img id="ruleta" src="/QuestionMark/view/img_page/ruleta.png" alt="Ruleta de categorías">

    <!-- Categoría elegida -->
    <p id="categoriaBox"></p>

    <!-- Leyenda de colores (opcional pero útil) -->
    <div class="leyenda">
        <span><span class="cuadro-color" style="background:#FF5733"></span>Historia</span>
        <span><span class="cuadro-color" style="background:#33B5FF"></span>Ciencia</span>
        <span><span class="cuadro-color" style="background:#0b842e"></span>Deportes</span>
        <span><span class="cuadro-color" style="background:#C700FF"></span>Arte</span>
        <span><span class="cuadro-color" style="background:#FFC300"></span>Geografía</span>
        <span><span class="cuadro-color" style="background:#FF33A8"></span>Matemática</span>
        <span><span class="cuadro-color" style="background:#FF0000"></span>Literatura</span>
        <span><span class="cuadro-color" style="background:#16A085"></span>Cultura</span>
    </div>
</div>

<script>
    // Apenas carga la página, la ruleta gira automáticamente.
    window.addEventListener('load', girarRuleta);
    // Si el usuario hace clic sobre ella puede volver a girar.
    document.getElementById('ruleta').addEventListener('click', girarRuleta);

    function girarRuleta() {
        const imgRuleta = document.getElementById('ruleta');
        const grados    = 720 + Math.floor(Math.random() * 360); // 2 vueltas + aleatorio
        imgRuleta.style.transform = `rotate(${grados}deg)`;

        /* Al terminar la animación solicitamos la categoría a la API  */
        setTimeout(() => {
            fetch('/QuestionMark/index.php?controller=api&method=ruleta')

                    .then(r => r.ok ? r.json() : Promise.reject())
                    .then(data => {
                        if (!data.categoria) {
                            alert('No se pudo obtener la categoría');
                            return;
                        }

                        // Mostrarla un instante al usuario
                        document.getElementById('categoriaBox').textContent =
                                'Categoría: ' + data.categoria;

                        // Esperar 1 s y redirigir al controlador
                        setTimeout(() => {
                            location.href = '/QuestionMark/jugar/ruleta?categoria=' +
                                    encodeURIComponent(data.categoria);
                        }, 1000);
                    })
                    .catch(() => alert('Error al comunicarse con la API de ruleta'));
        }, 3000); // coincide con los 3 s de la transición CSS
    }
</script>
</body>
</html>

